define(["app","touch","cs!pager"],function(t){$.pager=function(t){a.init(t)};var a={init:function(t){this.parames(t),this.ajaxLoad(),this.scrollEvent()},parames:function(t){this.options=$.extend({$scope:null,lazyEle:"",scrollEle:"",repeatEle:"li",page:0,pageSize:10,url:"",data:{},repeatArr:null,count:null,callBack:null},t||{}),this.load=!1,$loadAllELe=$('<div class="loadAll">已经到底啦~</div>'),$swipLoad=$('<div class="swipLoad">下拉加载更多...</div>'),this.options.$scope.data=null,this.count=0},ajaxLoad:function(){var a=this;t.myApp.ajax({url:a.options.url,data:$.extend(a.options.data,{page:a.options.page})},function(t){if(t.err)$.toast(t.errMsg);else{if(a.options.callBack?a.options.callBack(t):(a.options.$scope.data?a.options.repeatArr?a.options.$scope[a.options.repeatArr]=a.options.$scope[a.options.repeatArr].concat(t[a.options.repeatArr]):a.options.$scope.data.rows=a.options.$scope.data.rows.concat(t.data.rows):a.options.$scope.data=t.data,a.options.$scope&&a.options.$scope.$digest()),a.options.lazyEle&&$(a.options.lazyEle).lazyLoad(),a.repeatArr=t[a.options.repeatArr]||t.data.rows,a.count+=a.repeatArr.length,a.options.count=a.options.count||t.data.count,a.loadAll=a.options.count?a.count>=a.options.count:"none",$(".swipLoad").remove(),"none"==a.loadAll)return;$(a.options.scrollEle).append(a.loadAll?$loadAllELe:$swipLoad),a.options.page++}setTimeout(function(){a.load=!1},500)})},scrollEvent:function(){var t=this;t.options.$scope.$watch("data",function(a,n){a!=n&&setTimeout(function(){$(t.options.scrollEle).swipeUp(function(){if(!t.loadAll&&$(t.options.repeatEle).eq($(t.options.repeatEle).length-1).offset().top-$(window).height()<0){if(t.load)return;t.load=!0,t.ajaxLoad()}})},200)})}}});