define(["app","cs!share"],function(n){var i,t={};return t.setContent=function(t,a,d,r,l){i={title:encodeURIComponent(t)||encodeURIComponent("美玩易试"),desc:encodeURIComponent(a)||encodeURIComponent("美玩易试"),img:encodeURIComponent(d)||encodeURIComponent(""),link:encodeURIComponent(r)||encodeURIComponent("")},n.myApp.naviuser.indexOf("micromessenger/")>-1?require(["wxjs"],function(i){n.myApp.ajax({url:"/site/wechatSign",data:{url:encodeURIComponent(location.href.split("#")[0])},loading:!1},function(m){if(!m.err){i.config({debug:!1,appId:m.data.appId,timestamp:m.data.timestamp,nonceStr:m.data.nonceStr,signature:m.data.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"]});var h={title:t,desc:a,link:r,imgUrl:d},u={title:t,link:r,imgUrl:d};l&&(n.myApp.extend(h,l),n.myApp.extend(u,l),l.wx&&l.wx(i)),i.onMenuShareAppMessage(h),i.onMenuShareTimeline(u),i.onMenuShareQQ(h),i.onMenuShareWeibo(h),i.onMenuShareQZone(h)}})}):($(".popup-share").remove(),$("body").append('<div class="popup popup-share"><div class="content-block"><div class="wrap"><div class="li qq"><div class="warp"></div></div><div class="li qqtx"><div class="warp"></div></div><div class="li qqkj"><div class="warp"></div></div><div class="li wb"><div class="warp"></div></div><div class="li rrw"><div class="warp"></div></div></div></div></div>'),$(document).on("click",".popup-share",function(e){$(e.srcElement).hasClass("popup-share")&&$.closeModal(".popup-share")}),$(document).on("click",".popup-share .li",function(){return $(this).hasClass("qq")?void(window.location.href="http://connect.qq.com/widget/shareqq/index.html?url="+i.link+"&desc="+i.title+"&pics="+i.img+"&site="+i.title):void($(this).hasClass("qqtx")?window.location.href="http://share.v.t.qq.com/index.php?c=share&a=index&title="+i.title+"&site="+i.link+"&pics="+i.img+"&url="+i.link+"&assname="+i.desc:$(this).hasClass("qqkj")?window.location.href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+i.link+"?&title="+i.title+"&pics="+i.img+"&summary="+i.desc:$(this).hasClass("wb")?window.location.href="http://service.weibo.com/share/share.php?appkey=583395093&title="+i.title+"&url="+i.link+"&source="+i.desc+"&retcode=0&ralateUid=":$(this).hasClass("rrw")&&(window.location.href="http://widget.renren.com/dialog/share?resourceUrl="+i.link+"&srcUrl="+i.link+"&title="+i.title+"&images="+i.img+"&description="+i.desc))}))},t.popupShare=function(){n.myApp.iniValue.isApp?"undefined"!=typeof window.jsObj&&window.jsObj.jump("shareApp",JSON.stringify({title:decodeURIComponent(i.title),content:decodeURIComponent(i.desc),imageUrl:decodeURIComponent(i.img),shareUrl:decodeURIComponent(i.link)})):(n.myApp.naviuser.indexOf("micromessenger/")>-1?$('<div class="wxfx" onclick="this.style.display=\'none\'"></div>').appendTo(".page"):n.myApp.naviuser.indexOf("ucbrowser/")>-1?require(["js/controllers/share/ucqqapi"],function(n){var t={url:decodeURIComponent(i.link),title:decodeURIComponent(i.title),desc:decodeURIComponent(i.desc),img:decodeURIComponent(i.img),img_title:decodeURIComponent(i.title),from:decodeURIComponent(i.title)},a=new n.nativeShare(t);a.share("")}):$.popup(".popup-share"),$("body").on("click",".modal-overlay",function(){$.closeModal()}))},t});