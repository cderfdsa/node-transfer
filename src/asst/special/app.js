define(["angular","ngAsync","ngUirouter","ngSanitize"],function(i,t){var n={};n.viewport=function(i){var t="device"==i?"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no":"target-densitydpi=device-dpi, width=640px, user-scalable=no";$("[name='viewport']").prop("content",t)},n.cookie=function(){var i={};return"undefined"!=typeof window.localStorage&&(i=window.localStorage),i}(),n.localStorage=function(){var i={};return"undefined"!=typeof window.localStorage&&(i=window.localStorage),i}(),n.query=$.parseUrlQuery(location.href.split("#")[1]),n.iniValue={appData:JSON.parse(n.localStorage.getItem("appData"))||{},key:n.query.key||n.localStorage.getItem("key")||"",cityId:n.query.cityId||("null"==n.localStorage.getItem("cityId")?"":n.localStorage.getItem("cityId"))||52,controller:"./static/controller/",service:"./common/service/",template:"./page/",directive:"./common/directive/",version:"1.9.5",isFirstLoading:function(){var i=!$.getCookie("isFirstLoading");return i&&$.setCookie("isFirstLoading","no"),i}(),isLogin:function(){return!!$.getCookie("user_login_token")&&(new Date).getTime()<$.getCookie("user_login_token_expire")},isApp:!1,isWeiXin:navigator.userAgent.toLowerCase().indexOf("micromessenger/")>-1,hostname:function(){var i=window.location.href;return i.indexOf("/src/")>-1?i.split("/src/")[0]+"/src/":i.indexOf("/dist/")>-1?i.split("/dist/")[0]+"/dist/":window.location.hostname}()},n.settitle=function(i,t,a){if(i.init.headinfo.title=t,"undefined"!=typeof window.jsObj){window.jsObj.jump("title",t);var r=a;a&&(r=n.iniValue.hostname+"#/"+a),window.jsObj.jump("backUrl",r||"pop")}$("body");document.title=t},n.toAppShareData=function(){"undefined"!=typeof window.jsObj},n.generateGUID=function(){var i=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var t=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==c?t:7&t|8).toString(16)});return t},n.ajaxLoad={show:function(){$(".loading").show()},hide:function(){$(".loading").hide()}},n.device=$.device,n.naviuser=navigator.userAgent.toLowerCase(),n.extend=function(o,i,t){for(var p in i)!i.hasOwnProperty(p)||o.hasOwnProperty(p)&&!t||(o[p]=i[p])},n.ajax=function(i,t,a){this.parame=i,this.parameData=i.data||{};var r={loading:!0,timeout:1e5,async:!0,type:"POST",url:"/",data:{backUrl:location.href,user_login_token:$.getCookie("user_login_token")},dataType:"json",processData:!0,contentType:"application/x-www-form-urlencoded",withCredentials:$origin,crossDomain:$origin};n.extend(this.parame,r),n.extend(this.parameData,r.data),r=this.parame,$.ajax({type:r.type,url:$ajaxDomain+r.url+("/test"==$ajaxDomain?".json":""),data:r.data||{},dataType:r.dataType,timeout:r.timeout,processData:r.processData,contentType:r.contentType,xhrFields:{withCredentials:r.withCredentials},crossDomain:r.crossDomain,beforeSend:function(){r.loading&&n.ajaxLoad.show()},success:function(i){if(-1==i.err)if(n.iniValue.isWeiXin)n.thirdLogin("weixin",location.hash);else if(0==n.ifLogin(location.hash))return;t(i)},error:function(i){a?a(i):$.toast?$.toast("未知错误"):""},complete:function(){n.ajaxLoad.hide()}})},n.http=function(i,t,a,r,l){var d=t.method.toUpperCase()||"POST",u=/\?localtest$/g.test(location.hash)?"/test":"/api",g=$.extend({user_login_token:$.getCookie("user_login_token")},t.data||{});t.loading&&n.ajaxLoad.show(),i({url:u+t.url+("/test"==u?".json":""),method:d,data:"GET"!=d&&g||{},params:"GET"==d&&g||{},headers:{"X-Requested-With":"XMLHttpRequest"}}).success(function(i,r,d,u){return n.ajaxLoad.hide(),0==t.defaultResErr?void a(i,r,d,u):void(i.err?$.toast(i.errMsg,2e3,l||""):a(i,r,d,u))}).error(function(i,t,a,l){r?r(i,t,a,l):$.toast?$.toast("未知错误"):"",n.ajaxLoad.hide()})},n.getRandomInt=function(i,t){return Math.floor(Math.random()*(t-i+1))+i},n.ifLogin=function(i){var t=i||location.hash;if(!(t.indexOf("#/userCenter/login/signIn/1")>-1))return n.iniValue.isLogin()?void 0:(localStorage.loginBackHash=t,location.hash="#/userCenter/login/signIn/1",!1)},n.thirdLogin=function(i,t){var a=(t||localStorage.loginBackHash||"").replace("#","")||"/home";localStorage.removeItem("loginBackHash"),n.iniValue.isLogin()&&(location.hash=a),$.setCookie("thirdLoginBind","",-1),location.href="/auth/"+i+"?backUrl="+a},n.thirdBind=function(i){if(!n.iniValue.isWeiXin){var t=(localStorage.loginBackHash||location.hash).replace("#","");0!=n.ifLogin()&&($.setCookie("thirdLoginBind",i),localStorage.removeItem("loginBackHash"),location.href="/auth/"+i+"?backUrl="+t)}},n.loginOut=function(){n.iniValue.isLogin()&&!n.iniValue.isWeiXin&&($.setCookie("user_login_token","",-1),$.setCookie("user_login_token_expire","",-1),location.href="/logout")},n.naviuser.indexOf("micromessenger/")>0&&require(["wxjs"]),n.androidKeyBug=function(){if(n.device.android&&n.naviuser.indexOf("micromessenger/")>-1){var i=[];setInterval(function(){var t=parseInt(window.innerHeight);if(i.indexOf(t)<0&&i.push(t),i[1]){var n=parseInt(i[0])-parseInt(i[1]);n>0&&(i=[]),0>n&&(i=[],$("input").blur())}},100)}};var a=i.module("mwapp",["ui.router","ngSanitize"]);return t.configure(a),{angular:a,myApp:n}});